<!DOCTYPE html>
<html>
<head>
  <title>Weather Report</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
  <style>
    #map { height: 500px; margin: 20px 0; }
    form { max-width: 600px; margin: auto; padding: 20px; }
    input, select, textarea { width: 100%; margin: 10px 0; padding: 8px; }
    button { background: #4CAF50; color: white; padding: 12px; border: none; width: 100%; }
  </style>
</head>
<body>
  <form id="reportForm">
    <!-- Name and ID -->
    <input type="text" name="name" placeholder="Name" required>
    <input type="number" name="id" placeholder="ID Number" required>

    <!-- State Dropdown (All 50 States) -->
    <select name="state" required>
      <option value="">Select State</option>
      <option value="AL">Alabama</option>
      <option value="AK">Alaska</option>
      <option value="AZ">Arizona</option>
      <option value="AR">Arkansas</option>
      <option value="CA">California</option>
      <option value="CO">Colorado</option>
      <option value="CT">Connecticut</option>
      <option value="DE">Delaware</option>
      <option value="FL">Florida</option>
      <option value="GA">Georgia</option>
      <option value="HI">Hawaii</option>
      <option value="ID">Idaho</option>
      <option value="IL">Illinois</option>
      <option value="IN">Indiana</option>
      <option value="IA">Iowa</option>
      <option value="KS">Kansas</option>
      <option value="KY">Kentucky</option>
      <option value="LA">Louisiana</option>
      <option value="ME">Maine</option>
      <option value="MD">Maryland</option>
      <option value="MA">Massachusetts</option>
      <option value="MI">Michigan</option>
      <option value="MN">Minnesota</option>
      <option value="MS">Mississippi</option>
      <option value="MO">Missouri</option>
      <option value="MT">Montana</option>
      <option value="NE">Nebraska</option>
      <option value="NV">Nevada</option>
      <option value="NH">New Hampshire</option>
      <option value="NJ">New Jersey</option>
      <option value="NM">New Mexico</option>
      <option value="NY">New York</option>
      <option value="NC">North Carolina</option>
      <option value="ND">North Dakota</option>
      <option value="OH">Ohio</option>
      <option value="OK">Oklahoma</option>
      <option value="OR">Oregon</option>
      <option value="PA">Pennsylvania</option>
      <option value="RI">Rhode Island</option>
      <option value="SC">South Carolina</option>
      <option value="SD">South Dakota</option>
      <option value="TN">Tennessee</option>
      <option value="TX">Texas</option>
      <option value="UT">Utah</option>
      <option value="VT">Vermont</option>
      <option value="VA">Virginia</option>
      <option value="WA">Washington</option>
      <option value="WV">West Virginia</option>
      <option value="WI">Wisconsin</option>
      <option value="WY">Wyoming</option>
    </select>

    <!-- ZIP Code -->
    <input type="text" name="zip" placeholder="ZIP Code" pattern="\d{5}" required>

    <!-- Weather Type with Emoji Icons -->
    <select name="weatherType" required>
      <option value="">Select Weather Type</option>
      <option value="tornado">🌪️ Tornado</option>
      <option value="funnel_cloud">🌪️ Funnel Cloud</option>
      <option value="hail">🌨️ Hail</option>
      <option value="damaging_winds">🌬️ Damaging Winds</option>
      <option value="dense_fog">🌫️ Dense Fog</option>
      <option value="sleet">🌨️ Sleet</option>
      <option value="heavy_snow">❄️ Heavy Snow</option>
      <option value="fire">🔥 Fire</option>
      <option value="thunderstorm">⛈️ Severe Thunderstorm</option>
      <option value="flooding">🌊 Flooding</option>
    </select>

    <!-- Notes -->
    <textarea name="notes" placeholder="Additional Notes"></textarea>
    <button type="submit">Submit Report</button>
  </form>

  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

  <!-- Script to Handle Form and Map -->
  <script>
    // Initialize Map
    const map = L.map('map').setView([37.8, -96], 4);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Submit Form to Google Sheets
    document.getElementById('reportForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);

      try {
        await fetch('https://script.google.com/macros/s/AKfycbwjdG7AXmOGX8SBcLVogYQM-UcG_UUzBHUd6eEX1DPHv5KBkOI3CUs3sVZiyf3puo49wg/exec', {
          method: 'POST',
          body: formData
        });
        alert('Report submitted!');
        e.target.reset(); // Clear form
      } catch (error) {
        alert('Error submitting report.');
      }
    });

    // Load Markers from Google Sheet CSV
    async function loadMarkers() {
      try {
        const response = await fetch('https://docs.google.com/spreadsheets/d/1QDc5s1UhHzHkC5gIXkHqn1DbZgOr7s4k_-VUHGFlPmk/edit?usp=sharing');
        const csvData = await response.text();

        csvData.split('\n').slice(1).forEach(row => {
          const [timestamp, name, id, state, zip, weather, notes, lat, lng] = row.split(',');

          // Weather Icons
          const weatherIcons = {
            tornado: '🌪️',
            funnel_cloud: '🌪️',
            hail: '🌨️',
            damaging_winds: '🌬️',
            dense_fog: '🌫️',
            sleet: '🌨️',
            heavy_snow: '❄️',
            fire: '🔥',
            thunderstorm: '⛈️',
            flooding: '🌊'
          };

          // Add Marker to Map
          L.marker([lat, lng])
            .addTo(map)
            .bindPopup(`
              <b>${name}</b><br>
              <b>Weather:</b> ${weatherIcons[weather]} ${weather}<br>
              <b>Notes:</b> ${notes}
            `);
        });
      } catch (error) {
        console.error('Error loading markers:', error);
      }
    }

    loadMarkers(); // Load markers on page load
  </script>
</body>
</html>
